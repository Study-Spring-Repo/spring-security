# CsrfFilter

> ### CSRF (Cross-site request forgery)

- 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위를 특정 웹사이트에 요청하게 하는 공격
- CSRF를 통해 악의적인 공격자는 사용자의 권한을 도용하여 중요 기능을 실행할 수 있다.
  - (두 가지 조건이 만족되어야 한다.)
    - 위조 요청을 전송하는 서비스에 사용자가 로그인한 상태이어야 한다.
    - 사용자가 해커가 만든 피싱 사이트에 접속해야 한다.


- XSS는 자바스크립트를 싱행하는 것이고, CSRF는 특정한 행동을 시키는 것이다.


> ### 방법
  - Referrer 검증
    - Request의 referrer를 확인하여 domain이 일치하는지 확인한다.
  - CSRF Token 활용
    - 사용자의 세션에 임의의 토큰 값을 저장한다.
      - 사용자의 요청마다 해당 토큰 값을 포함시켜 전송한다.
    - 리소스를 변경해야하는 요청을 받을 때마다 `사용자의 세션에 저장된 토큰 값`과 `요청 파라미터에 전달되는 토큰 값`이 일치하는 지 검증한다.
    - 브라우저가 아닌 클라이언트에서 사용하는 서비스의 경우 CSRF 보호를 비활성화 할 수 있다.

> ### CsrfFilter

- 요청이 리소스를 변경해야 하는 요청인지 확인하고, 맞다면 CSRF 토큰을 검증한다.
  - 기본적으로 활성화 되어 있다.

> ### CsrfTokenRepository

- CSRF 토큰 저장소 인터페이스이며 기본 구현체로 `HttpSessionCsrfTokenRepository` 클래스가 사용된다.